generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum InvoiceMode {
  GENERAL
  DISCRIMINATED
}

model CompanyGroup {
  id        String    @id @default(cuid())
  name      String
  document  String    @unique
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  companies  Company[]
  units      Unit[]
  bases      Base[]
  ambulances Ambulance[]
  phones     Phone[]
  users      User[]

  @@map("company_groups")
}

model Company {
  id        String    @id @default(cuid())
  name      String
  document  String    @unique
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  companyGroup   CompanyGroup @relation(fields: [companyGroupId], references: [id])
  companyGroupId String       @map("company_group_id")

  units Unit[]
  bases Base[]

  phones     Phone[]
  ambulances Ambulance[]
  users      User[]

  @@map("companies")
}

model Unit {
  id   String @id @default(cuid())
  name String

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  companyGroup   CompanyGroup @relation(fields: [companyGroupId], references: [id])
  companyGroupId String       @map("company_group_id")

  company   Company @relation(fields: [companyId], references: [id])
  companyId String  @map("company_id")

  bases Base[]

  phones     Phone[]
  ambulances Ambulance[]
  users      User[]

  @@map("units")
}

model Base {
  id        String    @id @default(cuid())
  name      String
  document  String?   @unique
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  latitude  Float?
  longitude Float?

  companyGroup   CompanyGroup @relation(fields: [companyGroupId], references: [id])
  companyGroupId String       @map("company_group_id")

  company   Company @relation(fields: [companyId], references: [id])
  companyId String  @map("company_id")

  unit   Unit   @relation(fields: [unitId], references: [id])
  unitId String @map("unit_id")

  phones     Phone[]
  ambulances Ambulance[]
  users      User[]

  @@map("bases")
}

model Phone {
  id         String  @id @default(cuid())
  number     String
  name       String?
  isWhatsapp Boolean @default(false) @map("is_whatsapp")

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  companyGroup   CompanyGroup? @relation(fields: [companyGroupId], references: [id])
  companyGroupId String?       @map("company_group_id")

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?  @map("company_id")

  unit   Unit?   @relation(fields: [unitId], references: [id])
  unitId String? @map("unit_id")

  base   Base?   @relation(fields: [baseId], references: [id])
  baseId String? @map("base_id")

  @@unique([number, baseId])
  @@unique([number, unitId])
  @@unique([number, companyId])
  @@unique([number, companyGroupId])
  @@index([number, baseId])
  @@index([number, unitId])
  @@index([number, companyId])
  @@index([number, companyGroupId])
}

model User {
  id                       String                   @id @default(cuid())
  name                     String
  document                 String                   @unique
  password                 String
  roles                    String[]                 @default([])
  birthDate                DateTime                 @map("birth_date")
  avatarUrl                String?                  @map("avatar_url")
  createdAt                DateTime                 @default(now()) @map("created_at")
  updatedAt                DateTime                 @updatedAt @map("updated_at")
  deletedAt                DateTime?                @map("deleted_at")
  ambulanceStatusHistories AmbulanceStatusHistory[]

  companyGroup   CompanyGroup? @relation(fields: [companyGroupId], references: [id])
  companyGroupId String?       @map("company_group_id")

  companies Company[]
  units     Unit[]
  bases     Base[]

  @@index([document])
  @@map("users")
}

enum AmbulanceStatusEnum {
  QAP
  OCP
  EVT
  J4
  J5
  FA
  MN
}

model Ambulance {
  id           String              @id @default(cuid())
  name         String
  status       AmbulanceStatusEnum @default(FA) @map("status")
  observations String?
  licensePlate String              @unique @map("license_plate")

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  companyGroup   CompanyGroup @relation(fields: [companyGroupId], references: [id])
  companyGroupId String       @map("company_group_id")

  company   Company @relation(fields: [companyId], references: [id])
  companyId String  @map("company_id")

  unit   Unit   @relation(fields: [unitId], references: [id])
  unitId String @map("unit_id")

  base   Base   @relation(fields: [baseId], references: [id])
  baseId String @map("base_id")

  documents     AmbulanceDocuments[]
  statusHistory AmbulanceStatusHistory[]

  @@index([licensePlate])
  @@map("ambulances")
}

model AmbulanceDocuments {
  id String @id @default(cuid())

  ambulance   Ambulance @relation(fields: [ambulanceId], references: [id])
  ambulanceId String    @map("ambulance_id")

  name          String
  downloadUrl   String @map("download_url")
  fileExtension String @map("file_extension")
  fileSize      Int    @map("file_size")

  createdAt DateTime  @default(now()) @map("created_at")
  expiresAt DateTime  @map("expires_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("ambulance_documents")
}

model AmbulanceStatusHistory {
  id String @id @default(cuid())

  ambulance   Ambulance @relation(fields: [ambulanceId], references: [id])
  ambulanceId String    @map("ambulance_id")

  fromStatus AmbulanceStatusEnum @map("from_status")
  toStatus   AmbulanceStatusEnum @map("to_status")

  user   User   @relation(fields: [userId], references: [id])
  userId String @map("user_id")

  createdAt DateTime @default(now()) @map("created_at")

  @@map("ambulance_status_histories")
}
